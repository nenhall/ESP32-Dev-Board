# ESP32-WROOM 快速开始指南

本指南将带你完成 ESP32-WROOM 开发板的第一个项目，从环境搭建到代码运行。

---

## 第一步：安装驱动

### Windows 系统
1. 下载 CH340 驱动：http://www.wch.cn/download/CH341SER_EXE.html
2. 解压并运行安装程序
3. 安装完成后连接开发板
4. 打开设备管理器，确认 COM 端口号

### Mac 系统
1. 下载 Mac 版驱动：https://macdrivers.com/ch340-mac-driver
2. 安装驱动
3. 打开终端，查看设备：
   ```bash
   ls /dev/cu.usbserial*
   ```

### Linux 系统
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install CH340-driver

# 查看设备
ls /dev/ttyUSB*
```

---

## 第二步：选择开发环境

### 方案 A：Arduino IDE（推荐新手）⭐

#### 1. 安装 Arduino IDE
下载：https://www.arduino.cc/en/software

#### 2. 添加 ESP32 支持
1. 打开 Arduino IDE
2. 文件 → 首选项
3. 附加开发板管理器网址添加：
   ```
   https://espressif.github.io/arduino-esp32/package_esp32_index.json
   ```
4. 工具 → 开发板 → 开发板管理器 → 搜索 "esp32" → 安装

#### 3. 配置开发板
```
开发板: ESP32 Dev Module
Upload Speed: 921600
CPU Frequency: 240MHz (WiFi/BT)
Flash Frequency: 80MHz
Flash Mode: QIO
Flash Size: 4MB (32Mb)
Partition Scheme: Default 4MB with spiffs (1.2MB APP/1.5MB SPIFFS)
```

### 方案 B：PlatformIO（推荐有经验的开发者）

#### 1. 安装 VSCode
下载：https://code.visualstudio.com/

#### 2. 安装 PlatformIO 扩展
1. 打开 VSCode
2. 扩展 → 搜索 "PlatformIO IDE"
3. 点击安装
4. 重启 VSCode

---

## 第三步：第一个项目 - LED 闪烁

### 项目目标
让 ESP32 开发板上的 LED 每秒闪烁一次

### Arduino IDE 版本

#### 1. 创建新程序
```
文件 → 新建
```

#### 2. 复制以下代码

```cpp
/*
 * ESP32 LED 闪烁示例
 * 板载 LED 连接在 GPIO2
 */

// LED 引脚定义（ESP32 Dev Module 的板载 LED）
const int LED_PIN = 2;

void setup() {
  // 初始化串口通信，波特率 115200
  Serial.begin(115200);
  delay(1000);  // 等待串口准备就绪

  // 设置 LED 引脚为输出模式
  pinMode(LED_PIN, OUTPUT);

  // 输出启动信息
  Serial.println("\n\n=== ESP32 LED 闪烁程序 ===");
  Serial.println("硬件: ESP32-WROOM-32");
  Serial.println("CPU 频率: 240MHz");
  Serial.println("Flash 大小: 4MB");
  Serial.println("========================\n");
}

void loop() {
  // LED 点亮
  digitalWrite(LED_PIN, HIGH);
  Serial.println("LED 开启");
  delay(1000);  // 延时 1000 毫秒（1秒）

  // LED 熄灭
  digitalWrite(LED_PIN, LOW);
  Serial.println("LED 关闭");
  delay(1000);  // 延时 1000 毫秒（1秒）
}
```

#### 3. 保存文件
```
文件 → 另存为 → blink.ino
```

#### 4. 选择串口
```
工具 → 端口 → 选择你的 COM 端口
```

#### 5. 上传程序
```
1. 点击上传按钮（→）
2. 等待编译完成
3. 如果需要，按住 BOOT 按钮
4. 等待上传完成（显示"上传完成"）
```

#### 6. 查看输出
```
工具 → 串口监视器
波特率设置: 115200
```

### PlatformIO 版本

#### 1. 创建项目
```
PlatformIO 首页 → New Project
Name: esp32_blink
Board: ESP32 Dev Module
Framework: Arduino
```

#### 2. 配置 platformio.ini

```ini
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; 串口波特率
monitor_speed = 115200

; 上传速度
upload_speed = 921600

; 串口过滤器（可选）
; monitor_filters = esp32_exception_decoder
```

#### 3. 主程序

在 `src/main.cpp` 中：

```cpp
#include <Arduino.h>

const int LED_PIN = 2;

void setup() {
  Serial.begin(115200);
  delay(1000);

  pinMode(LED_PIN, OUTPUT);

  Serial.println("\n\n=== ESP32 LED 闪烁程序 ===");
  Serial.println("使用 PlatformIO 开发");
  Serial.println("========================\n");
}

void loop() {
  digitalWrite(LED_PIN, HIGH);
  Serial.println("LED 开启");
  delay(1000);

  digitalWrite(LED_PIN, LOW);
  Serial.println("LED 关闭");
  delay(1000);
}
```

#### 4. 编译上传
```bash
# 编译项目
pio run

# 上传到开发板
pio run --target upload

# 打开串口监视器
pio device monitor
```

---

## 第四步：第二个项目 - Wi-Fi 连接

### 项目目标
连接到 Wi-Fi 网络，并打印 IP 地址

```cpp
/*
 * ESP32 Wi-Fi 连接示例
 */

#include <WiFi.h>

// Wi-Fi 配置
const char* ssid = "你的WiFi名称";
const char* password = "你的WiFi密码";

void setup() {
  Serial.begin(115200);
  delay(1000);

  Serial.println("\n\n=== ESP32 Wi-Fi 连接 ===\n");

  // 设置 Wi-Fi 模式为站点模式
  WiFi.mode(WIFI_STA);

  // 开始连接
  Serial.printf("正在连接到: %s\n", ssid);
  WiFi.begin(ssid, password);

  // 等待连接
  int timeout = 20;  // 超时时间（秒）
  while (WiFi.status() != WL_CONNECTED && timeout > 0) {
    delay(500);
    Serial.print(".");
    timeout--;
  }

  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("\n\n✓ Wi-Fi 连接成功!");
    Serial.printf("SSID: %s\n", WiFi.SSID().c_str());
    Serial.printf("IP 地址: %s\n", WiFi.localIP().toString().c_str());
    Serial.printf("网关: %s\n", WiFi.gatewayIP().toString().c_str());
    Serial.printf("子网掩码: %s\n", WiFi.subnetMask().toString().c_str());
    Serial.printf("DNS: %s\n", WiFi.dnsIP().toString().c_str());
    Serial.printf("信号强度 (RSSI): %d dBm\n", WiFi.RSSI());
  } else {
    Serial.println("\n\n✗ Wi-Fi 连接失败!");
    Serial.println("请检查:");
    Serial.println("1. WiFi 名称是否正确");
    Serial.println("2. WiFi 密码是否正确");
    Serial.println("3. WiFi 是否为 2.4GHz（不支持 5GHz）");
  }
}

void loop() {
  // 定期检查连接状态
  static unsigned long lastCheck = 0;
  if (millis() - lastCheck > 10000) {  // 每 10 秒检查一次
    lastCheck = millis();

    if (WiFi.status() == WL_CONNECTED) {
      Serial.printf("连接正常 - IP: %s, RSSI: %d dBm\n",
                    WiFi.localIP().toString().c_str(),
                    WiFi.RSSI());
    } else {
      Serial.println("连接断开，尝试重连...");
      WiFi.reconnect();
    }
  }
  delay(100);
}
```

### 修改步骤
1. 修改 `ssid` 和 `password` 为你的 Wi-Fi 信息
2. 确保使用 2.4GHz Wi-Fi（ESP32 不支持 5GHz）
3. 上传并运行
4. 查看串口监视器输出

---

## 第五步：调试技巧

### 串口调试
```cpp
// 打印变量值
int sensorValue = 42;
Serial.printf("传感器值: %d\n", sensorValue);

// 打印浮点数
float temperature = 23.56;
Serial.printf("温度: %.2f°C\n", temperature);

// 打印十六进制
int hexValue = 255;
Serial.printf("十六进制: 0x%02X\n", hexValue);

// 打印多个值
Serial.printf("X: %d, Y: %d, Z: %d\n", x, y, z);
```

### 故障排查

#### 上传失败
```
问题: Failed to connect
解决:
1. 按住 BOOT 按钮，点击上传
2. 松开 BOOT 按钮
3. 如果还不行，按一下 EN/RST 按钮
```

#### 串口无输出
```
1. 检查波特率是否为 115200
2. 按一下 EN/RST 复位按钮
3. 确认选择了正确的 COM 端口
```

#### 程序不运行
```
1. 检查编译是否有错误
2. 查看串口监视器是否有错误信息
3. 简化代码，逐步添加功能
```

---

## 第六步：进阶项目

### Web 服务器
控制 LED 的简单 Web 服务器：

```cpp
#include <WiFi.h>
#include <WebServer.h>

WebServer server(80);

const char* ssid = "你的WiFi";
const char* password = "你的密码";

const int LED_PIN = 2;

void handleRoot() {
  String html = "<h1>ESP32 控制面板</h1>";
  html += "<p><a href='/on'><button>LED 开</button></a></p>";
  html += "<p><a href='/off'><button>LED 关</button></a></p>";
  html += "<p>LED 状态: ";
  html += (digitalRead(LED_PIN) ? "开启" : "关闭");
  html += "</p>";
  server.send(200, "text/html", html);
}

void handleOn() {
  digitalWrite(LED_PIN, HIGH);
  server.sendHeader("Location", "/");
  server.send(303);
}

void handleOff() {
  digitalWrite(LED_PIN, LOW);
  server.sendHeader("Location", "/");
  server.send(303);
}

void setup() {
  Serial.begin(115200);
  pinMode(LED_PIN, OUTPUT);

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("\nWiFi 连接成功!");
  Serial.print("IP 地址: ");
  Serial.println(WiFi.localIP());

  server.on("/", handleRoot);
  server.on("/on", handleOn);
  server.on("/off", handleOff);

  server.begin();
  Serial.println("Web 服务器启动");
  Serial.printf("访问: http://%s\n", WiFi.localIP().toString().c_str());
}

void loop() {
  server.handleClient();
}
```

---

## 项目结构建议

```
ESP32-Dev-Board/
├── docs/                    # 文档
├── examples/                # 示例代码
│   ├── blink/              # LED 闪烁
│   ├── wifi/               # Wi-Fi 连接
│   └── webserver/          # Web 服务器
├── src/                    # 源代码
├── config/                 # 配置文件
└── README.md
```

---

## 下一步学习

- **GPIO 控制**: 读取传感器、控制继电器
- **PWM 输出**: 调光 LED、控制舵机
- **ADC 读取**: 模拟传感器
- **I2C 通信**: OLED 显示屏、温湿度传感器
- **SPI 通信**: SD 卡、高速传感器
- **蓝牙**: BLE 通信
- **Deep Sleep**: 低功耗模式

查看更多示例，请访问 [examples/](../examples/) 目录。

---

## 获取帮助

- 查看 [完整开发指南](./开发指南.md)
- 阅读 [ESP32 官方文档](https://docs.espressif.com/projects/esp-idf/zh_CN/latest/)
- 访问 [ESP32 中文社区](https://www.esp32.com/)
